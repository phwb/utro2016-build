webpackJsonp([16],{86:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(87),o=r(i);e.exports=function(e,t){var n=t.id;if(!n)return!1;var r=new o["default"]({el:e,id:n});return r.render(),r}},87:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=Backbone.$;t(".poll-title").text(e.get("name"))}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),c=n(20),f=r(c),h=n(4),d=n(112),p=r(d),b=n(116),y=r(b),m=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),u(t,[{key:"initialize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.id;if(!t)throw new Error("чтобы посмотреть опрос, нужно передать айдишник");var n=f["default"].get(t);if(!n)throw new Error("на нашли опрос с таким айдишником "+t);this.$empty=this.$el.find(".empty-page"),this.$content=this.$el.find(".content-block-inner"),this.$el.find(".toolbar-poll").addClass("is-active"),this.model=n,this.listenTo(this.model,"vote:submit",this.submitFrom),this.listenTo(this.model,"change:voted",this.render)}},{key:"render",value:function(){var e=this;if(!this.model)return this;s(this.model),this.$empty.hide();var t=this.model.get("voted");return(0,h.getPollFields)(this.model).then(function(n){return e[t?"_renderResult":"_renderForm"](n)})["catch"](function(t){e.$empty.show(),a.logger.error(t)}).then(function(){}),this}},{key:"_renderResult",value:function(e){if(!e)return a.logger.error("poll-form: ajax вернул пустой ответ"),this.$empty.show(),this;var t=new y["default"]({collection:e,el:this.$content});t.render()}},{key:"_renderForm",value:function(e){if(!e)return a.logger.error("poll-form: ajax вернул пустой ответ"),this.$empty.show(),this;var t=new p["default"]({collection:e,model:this.model,el:this.$content});t.render()}},{key:"submitFrom",value:function(e){var t=this;if(!e)return(0,a.myAlert)("Выберите хотя бы одни вариант ответа!"),this;var n=this.$empty.attr("data-text");this.$content.empty(),this.$empty.attr("data-text","Загрузка результатов голосования...").show(),(0,h.setPollFields)(this.model,e).then(function(){t.model.set({voted:!0}).save(),t.$empty.hide()})["catch"](function(e){return(0,a.myAlert)(e.message)}).then(function(){return t.$empty.attr("data-text",n)})}}]),t}(Backbone.View);t["default"]=m},112:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(113),a=r(u),c=n(114),f=r(c),h=n(115),d=r(h),p=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){return this.$el.html(this.template(this.model)),this}},{key:"tagName",get:function(){return"li"}},{key:"className",get:function(){return"b-cr-list__item"}},{key:"template",get:function(){return _.template(d["default"])}}]),t}(Backbone.View),b=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){var e=this.model.answers;return this.$el.html(this.template(this.model)),this.$list=this.$el.find(".b-cr-list"),e.forEach(this.addAnswer,this),this}},{key:"addAnswer",value:function(e){var t=new p({model:e});this.$list.append(t.render().$el)}},{key:"tagName",get:function(){return"section"}},{key:"template",get:function(){return _.template(f["default"])}}]),t}(Backbone.View),y=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"submit",value:function(){var e=this.$el.find("form").serialize();this.model.trigger("vote:submit",e)}},{key:"addAll",value:function(){var e=this.collection;return e.length?(this.$el.html(a["default"]),this.$list=this.$el.find(".questions"),void e.forEach(this.addQuestion,this)):this}},{key:"addQuestion",value:function(e){var t=new b({model:e});this.$list.append(t.render().$el)}},{key:"render",value:function(){return this.addAll(),this}},{key:"events",get:function(){return{"click .submit-vote":"submit"}}}]),t}(Backbone.View);t["default"]=y},113:function(e,t){e.exports='<form><div class="questions"></div><div class="b-section b-txt-centered"><a class="item-link b-button submit-vote" href="#">Отправить</a></div></form>'},114:function(e,t){e.exports='<div class="b-section b-section_bg"><h2 class="b-no-space"><%= name %></h2></div><ul class="b-cr-list"></ul>'},115:function(e,t){e.exports='<input class="b-cr-list__input" type="<%= type %>" name="vote_<%= type %>_<%= questionID %><%= type === "checkbox" ? "[]" : "" %>" id="answer_<%= questionID %>_<%= id %>" value="<%= id %>"/><label class="b-cr-list__label" for="answer_<%= questionID %>_<%= id %>"><span class="b-cr-list__txt"><%= name %></span><svg class="b-cr-list__icon"><use xlink:href="#icon_check"></use></svg></label>'},116:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(117),a=r(u),c=n(118),f=r(c),h=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){return this.$el.html(this.template(this.model)),this}},{key:"tagName",get:function(){return"li"}},{key:"className",get:function(){return"b-poll-result__item"}},{key:"template",get:function(){return _.template(f["default"])}}]),t}(Backbone.View),d=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){var e=this.model.answers;return this.$el.html(this.template(this.model)),this.$list=this.$el.find(".b-poll-result"),e.forEach(this.addAnswer,this),this}},{key:"addAnswer",value:function(e){var t=new h({model:e});this.$list.append(t.render().$el)}},{key:"tagName",get:function(){return"section"}},{key:"template",get:function(){return _.template(a["default"])}}]),t}(Backbone.View),p=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return l(t,e),s(t,[{key:"addAll",value:function(){var e=this.collection;return e.length?(this.$el.html(""),void e.forEach(this.addQuestion,this)):this}},{key:"addQuestion",value:function(e){var t=new d({model:e});this.$el.append(t.render().$el)}},{key:"render",value:function(){return this.addAll(),this}}]),t}(Backbone.View);t["default"]=p},117:function(e,t){e.exports='<div class="b-section b-section_bg"><h2 class="b-no-space"><%= name %></h2></div><ul class="b-poll-result b-poll-result_bar-color_light"></ul>'},118:function(e,t){e.exports='<div class="b-poll-result__body"><div class="b-poll-result__txt"><%= name %></div><div class="b-poll-result__num"><%= parseInt(percent, 10) %>%</div></div><div class="b-poll-result__bar" style="width: <%= percent %>%"></div>'}});